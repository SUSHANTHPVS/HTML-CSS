<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Realistic Weather App with Day/Night</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.10/css/weather-icons.min.css">
<style>
  body {
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: "Segoe UI", sans-serif;
    overflow: hidden;
    transition: background 1s ease;
  }
  .sunny { background: linear-gradient(to top, #FFD54F, #FFB74D); }
  .cloudy { background: linear-gradient(to top, #90A4AE, #B0BEC5); }
  .rain { background: linear-gradient(to top, #3F51B5, #2196F3); }
  .thunderstorm { background: linear-gradient(to top, #212121, #424242); }
  .snow { background: linear-gradient(to top, #E1F5FE, #B3E5FC); }
  .night { background: linear-gradient(to top, #0D1B2A, #1B263B); }

  #weatherCanvas {
    position: fixed;
    top: 0;
    left: 0;
    z-index: -1;
  }

  .weather-container {
    background: rgba(255, 255, 255, 0.9);
    padding: 25px;
    border-radius: 20px;
    text-align: center;
    width: 400px;
    box-shadow: 0px 6px 20px rgba(0,0,0,0.2);
    animation: fadeIn 1s ease-in-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  h1 { margin-bottom: 15px; font-size: 2rem; color: #222; }
  input { padding: 12px; width: 65%; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 15px; font-size: 1rem; }
  button { padding: 12px 15px; border: none; border-radius: 8px; background: #4CAF50; color: white; font-size: 1rem; cursor: pointer; margin: 5px; transition: background 0.3s ease; }
  button:hover { background: #45a049; }

  .weather-result {
    margin-top: 20px;
    font-size: 1.1rem;
    color: #222;
    background: #f9f9f9;
    border-radius: 15px;
    padding: 15px;
    box-shadow: 0px 3px 10px rgba(0,0,0,0.1);
  }
  .weather-result h2 { margin: 10px 0; font-size: 1.5rem; color: #333; }
  .weather-icon { font-size: 3rem; margin: 10px 0; animation: pulse 2s infinite; }
  @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

  .forecast { margin-top: 20px; }
  .forecast h3 { margin-bottom: 10px; font-size: 1.4rem; color: #444; }
  .forecast-scroll { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 10px; }
  .forecast-day { min-width: 110px; background: #ffffff; border-radius: 15px; padding: 12px; box-shadow: 0px 3px 8px rgba(0,0,0,0.1); flex: 0 0 auto; text-align: center; transition: transform 0.2s ease; }
  .forecast-day:hover { transform: translateY(-5px); }
  .forecast-day i { font-size: 2rem; margin: 5px 0; color: #333; }
</style>
</head>
<body class="sunny">
<canvas id="weatherCanvas"></canvas>
<audio id="thunderSound" src="https://www.soundjay.com/nature/thunder-1.mp3" preload="auto"></audio>

<div class="weather-container">
  <h1>üå§Ô∏è Weather Report</h1>
  <input type="text" id="cityInput" placeholder="Enter city (e.g., London)">
  <button onclick="getWeather()">Get Weather</button>
  <button onclick="getLocationWeather()">üìç Use My Location</button>

  <div class="weather-result" id="weatherResult"></div>
  <div class="forecast" id="forecast"></div>
</div>

<script>
const canvas = document.getElementById("weatherCanvas");
const ctx = canvas.getContext("2d");
const thunderSound = document.getElementById("thunderSound");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let animationType = "none";
let particles = [];
let lightningFlash = false;

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if(animationType === "rain" || animationType==="thunderstorm") {
    ctx.strokeStyle = "rgba(0,150,255,0.7)";
    ctx.lineWidth = 2;
    particles.forEach(p=>{
      ctx.beginPath();
      ctx.moveTo(p.x,p.y);
      ctx.lineTo(p.x,p.y+15);
      ctx.stroke();
      p.y+=p.speed;
      if(p.y>canvas.height)p.y=-10;
    });
  }

  if(animationType==="snow"){
    ctx.fillStyle="white";
    particles.forEach(p=>{
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
      ctx.fill();
      p.y+=p.speed;
      if(p.y>canvas.height)p.y=-10;
    });
  }

  if(animationType==="clouds"){
    ctx.fillStyle="rgba(255,255,255,0.8)";
    particles.forEach(p=>{
      ctx.beginPath();
      ctx.ellipse(p.x,p.y,50,25,0,0,Math.PI*2);
      ctx.fill();
      p.x+=p.speed;
      if(p.x>canvas.width+60)p.x=-60;
    });
  }

  if(animationType==="thunderstorm"){
    if(Math.random()<0.01){
      lightningFlash=true;
      let delay=Math.random()*3000+2000;
      setTimeout(()=>{thunderSound.currentTime=0;thunderSound.play()},delay);
    }
    if(lightningFlash){
      ctx.fillStyle="rgba(255,255,255,0.8)";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      setTimeout(()=>{lightningFlash=false},100);
    }
  }

  requestAnimationFrame(animate);
}

function setAnimation(type){
  animationType=type;
  particles=[];
  if(type==="rain"||type==="thunderstorm"){
    for(let i=0;i<200;i++){
      particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,speed:4+Math.random()*4});
    }
  }
  if(type==="snow"){
    for(let i=0;i<150;i++){
      particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,speed:1+Math.random()*2,size:2+Math.random()*3});
    }
  }
  if(type==="clouds"){
    for(let i=0;i<20;i++){
      particles.push({x:Math.random()*canvas.width,y:50+Math.random()*150,speed:0.5+Math.random()});
    }
  }
}

animate();

function getWeatherIconClass(code, isDay){
  if([0].includes(code))return isDay?"wi-day-sunny":"wi-night-clear";
  if([1,2].includes(code))return isDay?"wi-day-cloudy":"wi-night-alt-cloudy";
  if([3].includes(code))return isDay?"wi-cloudy":"wi-cloudy";
  if([45,48].includes(code))return "wi-fog";
  if([51,53,55,56,57].includes(code))return "wi-sprinkle";
  if([61,63,65].includes(code))return "wi-rain";
  if([66,67].includes(code))return "wi-rain-mix";
  if([71,73,75,77].includes(code))return "wi-snow";
  if([80,81,82].includes(code))return "wi-showers";
  if([85,86].includes(code))return "wi-snow-wind";
  if([95].includes(code))return "wi-thunderstorm";
  if([96,99].includes(code))return "wi-storm-showers";
  return "wi-na";
}

function applyAnimationByCode(code, isDay){
  if([95,96,99].includes(code)){
    setAnimation("thunderstorm");
    document.body.className = isDay?"thunderstorm":"night";
  } else if([51,53,55,56,57,61,63,65,66,67,80,81,82].includes(code)){
    setAnimation("rain");
    document.body.className = isDay?"rain":"night";
  } else if([71,73,75,77,85,86].includes(code)){
    setAnimation("snow");
    document.body.className = isDay?"snow":"night";
  } else if([1,2,3,45,48].includes(code)){
    setAnimation("clouds");
    document.body.className = isDay?"cloudy":"night";
  } else{
    setAnimation("none");
    document.body.className = isDay?"sunny":"night";
  }
}

// The rest of getWeather, getLocationWeather, fetchWeather functions stay the same
// But in fetchWeather we calculate day/night based on local time
async function fetchWeather(lat, lon, city, country){
  const resultDiv=document.getElementById("weatherResult");
  const forecastDiv=document.getElementById("forecast");
  try{
    const res=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`);
    const data=await res.json();
    const time = new Date(data.current_weather.time);
    const hours = time.getHours();
    const isDay = hours>=6 && hours<18;

    const currentCode = data.current_weather.weathercode;
    const iconClass = getWeatherIconClass(currentCode, isDay);
    applyAnimationByCode(currentCode, isDay);

    resultDiv.innerHTML=`<h2>${city}${country? ", "+country:""}</h2>
      <i class="wi ${iconClass} weather-icon"></i>
      <p><strong>${data.current_weather.temperature}¬∞C</strong></p>
      <p>üí® Wind: ${data.current_weather.windspeed} km/h</p>
      <p>üïí ${data.current_weather.time}</p>`;

    forecastDiv.innerHTML="<h3>5-Day Forecast</h3><div class='forecast-scroll'></div>";
    const forecastScroll = forecastDiv.querySelector(".forecast-scroll");
    for(let i=0;i<5;i++){
      const icon=getWeatherIconClass(data.daily.weathercode[i], true);
      forecastScroll.innerHTML+=`<div class="forecast-day">
        <span><strong>${data.daily.time[i]}</strong></span>
        <i class="wi ${icon}"></i>
        <span>‚¨ÜÔ∏è ${data.daily.temperature_2m_max[i]}¬∞C</span>
        <span>‚¨áÔ∏è ${data.daily.temperature_2m_min[i]}¬∞C</span>
      </div>`;
    }
  } catch(err){
    resultDiv.innerHTML="‚ö†Ô∏è Error fetching data.";
  }
}

async function getWeather() {
  const city = document.getElementById("cityInput").value;
  if (!city) {
    document.getElementById("weatherResult").innerHTML = "‚ö†Ô∏è Please enter a city name.";
    return;
  }
  const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1`);
  const geoData = await geoRes.json();
  if (!geoData.results) {
    document.getElementById("weatherResult").innerHTML = "‚ùå City not found!";
    return;
  }
  const lat = geoData.results[0].latitude;
  const lon = geoData.results[0].longitude;
  fetchWeather(lat, lon, geoData.results[0].name, geoData.results[0].country);
}

function getLocationWeather(){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      fetchWeather(pos.coords.latitude,pos.coords.longitude,"Your Location","");
    },()=>{document.getElementById("weatherResult").innerHTML="‚ö†Ô∏è Unable to retrieve location."});
  } else {
    document.getElementById("weatherResult").innerHTML="‚ùå Geolocation not supported.";
  }
}
</script>
</body>
</html>
